import { Notes } from 'mdx-deck';

# Testing

<Notes>
	There's some common issues you may encounter while testing for an update to PHP7+.
	We'll cover these common problems and fixes for them.
</Notes>

---

# Backwards Incompatible Changes

<Notes>
	You may encounter more than these -- but here's some of the breaking changes to be aware of.
</Notes>

---

# Alternative PHP Tags

```php
// PHP 5 compatible script tags
<script language="php"> ... </script>

// PHP 5 compatible ASP tags
<% ... %>

// PHP 5 and 7 compatible standard tags
<?php ... ?>
<?= ... ?>
```

<Notes>
	PHP had alternative open and close tags that are now removed.
	Make sure to use the standard PHP open and close tags instead.
</Notes>

---

# Old MySQL Functions

* mysql_connect()
* mysql_select_db()
* mysql_query()
* mysql_fetch_array()
* mysql_error()

<Notes>
	Not a comprehensive list above.
	All mysql_* functions are gone -- removed in PHP 7.
	This may be the largest change to existing code, so take a look for these.
	For the most part, all can be swapped with the corresponding mysqli_* function.
	About 50% require passing an additional argument, the DB handle, as the first arg.
</Notes>

---

# POSIX Compatible Regex

* ereg()
* eregi()
* ereg_replace()
* eregi_replace()
* split()
* spliti()
* sql_regcase()

<Notes>
	Switch to the preg_* family of functions instead as these functions are now removed.
	The compatibility is very similar, although there's two typical changes that need to be made.
	1) The addition of delimiters around the expression string (usually a "/").
	2) Using the "i" modifier instead of dedicated case-insensitive functions.
	There are also subtle changes in match greediness to watch out for.
</Notes>

---

# Multiple Default Switch Blocks

```php
// PHP 5 compatible
switch ( $x ) {
    default:
         echo "I won't be executed in PHP 5";
         break;
    default:
         echo "I will be executed in PHP 5";
         break;
}
```

<Notes>
	This was a bug, but it's no longer possible to define 2+ define blocks in a switch statement.
	This will throw a fatal in PHP 7.
	Previously, only the last default would execute.
</Notes>

---

# Error and Exception Handling

```php
// PHP 5 compatible
function my_custom_error handler( Exception $e ) { 
	...
}
set_exception_handler( 'my_custom_error_handler' );

// PHP 5 and 7 compatible
function my_custom_error handler( $e ) {
        ...
}

// PHP 7 compatible
function my_custom_error handler( Throwable $e ) {
        ...
}
```

<Notes>
	Many fatal and recoverable fatal errors have been converted to exceptions in PHP 7.
	Custom error handlers may no longer be triggered because exceptions are thrown instead.
	For example, set_exception_handler() is no longer guaranteed to receive exceptions.
	This will cause fatal errors when an Error object is thrown.
</Notes>

---

# global Keyword

```php
// PHP 5 compatible
global $$foo->bar;

// PHP 5 and 7 compatible
global ${$foo->bar};
```

<Notes>
	The global keyword will now only take unambiguous variables.
	Make sure to add braces to make it unambiguous.
</Notes>
